---
import PageLayout from '../../layouts/PageLayout.astro';
import { loadPageBySlug } from '../../lib/content/adapter';

export async function getStaticPaths() {
  const modules = import.meta.glob('../../content/csr/*.json', { eager: true });
  return Object.entries(modules)
    .map(([filePath, module]) => {
      const csr = filePath
        .replace('../../content/csr/', '')
        .replace('.json', '');
      const status = (module as any).status || 'published';
      if (status !== 'published') return null;
      return { params: { csr } };
    })
    .filter(Boolean);
}

const csr = Astro.params.csr as string;
const page = await loadPageBySlug(csr, 'csr');

if (!page) {
  return new Response(null, {
    status: 404,
    statusText: 'CSR page not found'
  });
}
---
<PageLayout page={page} theme="default" />
