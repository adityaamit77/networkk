---
import PageLayout from '../../layouts/PageLayout.astro';
import { loadPageBySlug } from '../../lib/content/adapter';

export async function getStaticPaths() {
  const modules = import.meta.glob('../../content/pages/services/*.json', { eager: true });
  return Object.entries(modules)
    .map(([filePath, module]) => {
      const service = filePath
        .replace('../../content/pages/services/', '')
        .replace('.json', '');
      const status = (module as any).status || 'published';
      if (status !== 'published') return null;
      return { params: { service } };
    })
    .filter(Boolean);
}

const service = Astro.params.service as string;
const page = await loadPageBySlug(`services/${service}`);

if (!page) {
  return new Response(null, {
    status: 404,
    statusText: 'Page not found'
  });
}
---
<PageLayout page={page} theme="default" />
